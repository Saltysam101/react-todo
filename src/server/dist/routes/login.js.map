{"version":3,"file":"login.js","names":["router","express","Router","get","req","res","session","user","send","loggedIn","post","email","body","password","bcrypt","compare","Password","err","response","console","error","log","status"],"sources":["../../routes/login.js"],"sourcesContent":["import express from \"express\";\r\nimport bcrypt from \"bcrypt\";\r\nimport query from \"../db/utils\";\r\n\r\nconst router = express.Router();\r\n\r\nrouter.get(\"/\", async(req, res) => {\r\n    if (await req.session.user) {\r\n        res.send({ loggedIn: true, user: req.session.user })\r\n    } else {\r\n        res.send({ loggedIn: false })\r\n    }\r\n})\r\n\r\nrouter.post(\"/\", async(req, res) => {\r\n    let email = req.body.email;\r\n    let password = req.body.password;\r\n\r\n    let user = await query(\"SELECT * FROM users WHERE Email = ?\", [email])\r\n\r\n    bcrypt.compare(password, user[0].Password, (err, response) => {\r\n        if (err) {\r\n            console.error(err)\r\n        } else if (response === true) {\r\n            req.session.user = user\r\n                //console.log(\"reqsession\", req.session.user)\r\n\r\n            //console.log(\"session\", req.sessionID)\r\n                //console.log(\"cookie\", req.session.cookie)\r\n            console.log(\"login successful\")\r\n            res.status(200).send(req.session.user)\r\n                /* console.log(user) */\r\n        } else {\r\n            console.log(\"incorrect credentials\")\r\n            res.status(401).send(\"incorrect credentials\")\r\n        }\r\n    })\r\n})\r\n\r\nexport default router;"],"mappings":"iXAAA;AACA;AACA;;AAEA,IAAMA,MAAM,GAAGC,oBAAQC,MAAR,EAAf;;AAEAF,MAAM,CAACG,GAAP,CAAW,GAAX,qHAAgB,iBAAMC,GAAN,EAAWC,GAAX;cACFD,GAAG,CAACE,OAAJ,CAAYC,IADV;YAERF,GAAG,CAACG,IAAJ,CAAS,EAAEC,QAAQ,EAAE,IAAZ,EAAkBF,IAAI,EAAEH,GAAG,CAACE,OAAJ,CAAYC,IAApC,EAAT,EAFQ;;YAIRF,GAAG,CAACG,IAAJ,CAAS,EAAEC,QAAQ,EAAE,KAAZ,EAAT,EAJQ,wDAAhB;;;;AAQAT,MAAM,CAACU,IAAP,CAAY,GAAZ,sHAAiB,kBAAMN,GAAN,EAAWC,GAAX;YACTM,KADS,GACDP,GAAG,CAACQ,IAAJ,CAASD,KADR;YAETE,QAFS,GAEET,GAAG,CAACQ,IAAJ,CAASC,QAFX;;cAII,uBAAM,qCAAN,EAA6C,CAACF,KAAD,CAA7C,CAJJ,SAITJ,IAJS;;YAMbO,mBAAOC,OAAP,CAAeF,QAAf,EAAyBN,IAAI,CAAC,CAAD,CAAJ,CAAQS,QAAjC,EAA2C,UAACC,GAAD,EAAMC,QAAN,EAAmB;cAC1D,IAAID,GAAJ,EAAS;gBACLE,OAAO,CAACC,KAAR,CAAcH,GAAd;cACH,CAFD,MAEO,IAAIC,QAAQ,KAAK,IAAjB,EAAuB;gBAC1Bd,GAAG,CAACE,OAAJ,CAAYC,IAAZ,GAAmBA,IAAnB;gBACI;;gBAEJ;gBACI;gBACJY,OAAO,CAACE,GAAR,CAAY,kBAAZ;gBACAhB,GAAG,CAACiB,MAAJ,CAAW,GAAX,EAAgBd,IAAhB,CAAqBJ,GAAG,CAACE,OAAJ,CAAYC,IAAjC;gBACI;cACP,CATM,MASA;gBACHY,OAAO,CAACE,GAAR,CAAY,uBAAZ;gBACAhB,GAAG,CAACiB,MAAJ,CAAW,GAAX,EAAgBd,IAAhB,CAAqB,uBAArB;cACH;YACJ,CAhBD,EANa,0DAAjB,0E;;;AAyBeR,M"}